import /init.board.rc
import /init.sc8830.usb.rc
import /init.wifi.rc

on early-init
    mount debugfs debugfs /sys/kernel/debug

    # set core dump resource limit
    setrlimit 4 -1 -1

    # coredump file will not be generated in release version
    write /proc/sys/kernel/core_pattern /dev/null

    chown system system /sys/devices/platform/panel/backlight/panel/brightness
    chown system system /sys/class/input/event0/device/device/enable
    chmod 777 /sys/class/input/event0/device/device/enable
    mount debugfs /sys/kernel/debug /sys/kernel/debug

on init
    mkdir /productinfo 0771 system system

    # Support Preload install apks
    mkdir /preload 0771 system system

    # See storage config details at https://source.android.com/devices/storage/

    # Support legacy paths
    symlink /sdcard /mnt/sdcard
    symlink /sdcard /storage/sdcard0

    #thermistor
    chown radio system /sys/class/sec/sec-thermistor/temp_adc
    chown radio system /sys/class/sec/sec-thermistor/temperature
    chown radio system /sys/class/sec/sec-thermistor/dcxo_temp_adc
    chown radio system /sys/class/sec/sec-thermistor/dcxo_temperature

    chown radio system /sys/class/thermal/thermal_zone1/temp
	
    mkdir /cache 0000 system system
    mkdir /efs 0774 system radio

on fs
    mount_all /fstab.sc8830
    mount pstore pstore /sys/fs/pstore
    symlink /system/res /res
    symlink /system/bin /bin

#Allow others to read fb devices
    chmod 660 /dev/graphics/fb0
    chmod 660 /dev/fb0

#permissions for debug
    chown system system /sys/power/restart_cpc
    chmod 0220 /sys/power/restart_cpc

on post-fs
    chown system system /productinfo
    chmod 0771 /productinfo

on post-fs-data

    # Set indication (checked by vold) that we have finished this action
    setprop vold.post_fs_data_done 1
    #SPRD: Add support for install apk to internal sdcard @{
    mkdir /data/internal-asec 0700 root root
    # @}

on early-boot
    # set RLIMIT_MEMLOCK to 64MB
    setrlimit 8 67108864 67108864

    # Support audio loopback test
    mkdir /dev/pipe 0755 system system
    exec -- /system/bin/mknod -m 666 /dev/pipe/mmi.audio.ctrl p
    # Support audio parameter stored
    mkdir /data/local/media 0771 media system

    chmod 660 /proc/cpt/wdtirq
    chmod 660 /proc/cpt/stop
    chmod 660 /proc/cpt/start
    chmod 660 /proc/cpt/modem
    chmod 660 /proc/cpt/dsp

    chown system root /proc/cpt/wdtirq
    chown system root /proc/cpt/stop
    chown system root /proc/cpt/start
    chown system root /proc/cpt/modem
    chown system root /proc/cpt/dsp

    chmod 660 /proc/cpw/wdtirq
    chmod 660 /proc/cpw/stop
    chmod 660 /proc/cpw/start
    chmod 660 /proc/cpw/modem
    chmod 660 /proc/cpw/dsp

    chown system root /proc/cpw/wdtirq
    chown system root /proc/cpw/stop
    chown system root /proc/cpw/start
    chown system root /proc/cpw/modem
    chown system root /proc/cpw/dsp

    chmod 660 /proc/cpwcn/wdtirq
    chmod 660 /proc/cpwcn/stop
    chmod 660 /proc/cpwcn/start
    chmod 660 /proc/cpwcn/modem
    chmod 660 /proc/cpwcn/dsp

    chown system root /proc/cpwcn/wdtirq
    chown system root /proc/cpwcn/stop
    chown system root /proc/cpwcn/start
    chown system root /proc/cpwcn/modem
    chown system root /proc/cpwcn/dsp

    chown system root /sys/class/rtcc/rtcc_trigger

on boot
    chmod 0644 /proc/cmdline
# Turn on all CPUs
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu2/online 1
    write /sys/devices/system/cpu/cpu3/online 1

    chown system system /sys/module/mali/parameters/gpu_cur_freq
    chown system system /sys/module/mali/parameters/gpufreq_max_limit
    chown system system /sys/module/mali/parameters/gpufreq_min_limit
    chown system system /sys/module/mali/parameters/gpufreq_table
    chown system system /sys/kernel/debug/mali0/memory_usage
    chown system system /sys/class/backlight/sprd_backlight/brightness

    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed
    chown system system /sys/devices/system/cpu/cpufreq/sprdemand/cpu_hotplug_disable
    chown system system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_freq
    chown system system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_enable
    chown system system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_enable
    chown system system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_upthreshold
    chown system system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_downdifferential
    chown media system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_freq
    chown media system /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_request
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chown system system /sys/devices/system/cpu/cpufreq/sprdemand/cpu_hotplug_disable
    chown media system /sys/devices/system/cpu/cpufreq/sprdemand/cpu_hotplug_disable
    chmod 0660 /sys/devices/system/cpu/cpufreq/sprdemand/cpu_hotplug_disable
    chmod 0660 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0660 /sys/devices/system/cpu/cpufreq/sprdemand/cpu_hotplug_disable
    chmod 0660 /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_freq
    chmod 0660 /sys/devices/platform/scxx30-dmcfreq.0/devfreq/scxx30-dmcfreq.0/ondemand/set_enable

    chown system system /sys/devices/system/cpu/cpuhotplug/cpu_hotplug_disable
    chown media system /sys/devices/system/cpu/cpuhotplug/cpu_hotplug_disable
    chmod 0660 /sys/devices/system/cpu/cpuhotplug/cpu_hotplug_disable

    chown system system /sys/class/graphics/fb0/dynamic_mipi_clk

    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO0
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO1
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO2
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO3
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO4
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/USB_MDIO5
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/TxCurrent
    chown shell shell /sys/devices/platform/bcm_hsotgctrl_phy_mdio/Squelch

# SENSORS
# Accelerometer_sensor
    chown system radio /sys/class/sensors/accelerometer_sensor/raw_data
    chown system radio /sys/class/sensors/accelerometer_sensor/calibration
    chown system radio /sys/class/sensors/accelerometer_sensor/reactive_alert
    chown system radio /sys/class/sensors/accelerometer_sensor/vendor
    chown system radio /sys/class/sensors/accelerometer_sensor/name
    chown system radio /sys/class/sensors/accelerometer_sensor/selftest
    chown system radio /sys/class/sensors/accelerometer_sensor/lowpassfilter
# Proximity_sensor
    chown system radio /sys/class/sensors/proximity_sensor/state
    chown system radio /sys/class/sensors/proximity_sensor/raw_data
    chown system radio /sys/class/sensors/proximity_sensor/prox_avg
    chown system radio /sys/class/sensors/proximity_sensor/prox_cal
    chown system radio /sys/class/sensors/proximity_sensor/vendor
    chown system radio /sys/class/sensors/proximity_sensor/name
    chown system radio /sys/class/sensors/proximity_sensor/thresh_high
    chown system radio /sys/class/sensors/proximity_sensor/thresh_low
    chown system radio /sys/class/sensors/proximity_sensor/barcode_emul_en

#audio pin mux
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp0_iis2
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp0_iis3
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp0_iis0
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp0_iis1
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp1_iis1
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp1_iis2
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp1_iis0
    chown system system /proc/pin_switch/bt_iis_sys_sel/cp1_iis3
    chown system system /proc/pin_switch/bt_iis_sys_sel/ap_iis3
    chown system system /proc/pin_switch/bt_iis_sys_sel/ap_iis2
    chown system system /proc/pin_switch/bt_iis_sys_sel/ap_iis1
    chown system system /proc/pin_switch/bt_iis_sys_sel/ap_iis0
    chown system system /proc/pin_switch/bt_iis_sys_sel/vbc_iis
    chown system system /proc/pin_switch/iis01_loop_sel
    chown system system /proc/pin_switch/iis23_loop_sel
    chown system system /proc/pin_switch/iis12_loop_sel
    chown system system /proc/pin_switch/iis02_loop_sel
    chown system system /proc/pin_switch/iis03_loop_sel
    chown system system /proc/pin_switch/iis13_loop_sel
    chown system system /proc/pin_switch/iis1_sys_sel/ap_iis1
    chown system system /proc/pin_switch/iis0_sys_sel/ap_iis0
    chown system system /proc/pin_switch/iis0_sys_sel/cp0_iis0
    chown system system /proc/pin_switch/iis0_sys_sel/cp1_iis0
    chown system system /proc/pin_switch/iis0_sys_sel/cp2_iis0
    chown system system /proc/pin_switch/iis1_sys_sel/cp2_iis1
    chown system system /proc/pin_switch/iis1_sys_sel/cp0_iis1
    chown system system /proc/pin_switch/iis1_sys_sel/cp1_iis1

    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp0_iis2
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp0_iis3
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp0_iis0
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp0_iis1
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp1_iis1
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp1_iis2
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp1_iis0
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/cp1_iis3
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/ap_iis3
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/ap_iis2
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/ap_iis1
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/ap_iis0
    chmod 0664 /proc/pin_switch/bt_iis_sys_sel/vbc_iis
    chmod 0664 /proc/pin_switch/iis01_loop_sel
    chmod 0664 /proc/pin_switch/iis23_loop_sel
    chmod 0664 /proc/pin_switch/iis12_loop_sel
    chmod 0664 /proc/pin_switch/iis02_loop_sel
    chmod 0664 /proc/pin_switch/iis03_loop_sel
    chmod 0664 /proc/pin_switch/iis13_loop_sel
    chmod 0664 /proc/pin_switch/iis1_sys_sel/ap_iis1
    chmod 0664 /proc/pin_switch/iis0_sys_sel/ap_iis0
    chmod 0664 /proc/pin_switch/iis0_sys_sel/cp0_iis0
    chmod 0664 /proc/pin_switch/iis0_sys_sel/cp1_iis0
    chmod 0664 /proc/pin_switch/iis0_sys_sel/cp2_iis0
    chmod 0664 /proc/pin_switch/iis1_sys_sel/cp2_iis1
    chmod 0664 /proc/pin_switch/iis1_sys_sel/cp0_iis1
    chmod 0664 /proc/pin_switch/iis1_sys_sel/cp1_iis1

    chown system system /dev/ttyGS0
    chmod 0770 /dev/snd/controlC0

    chown system system /dev/block/mmcblk0
    chmod 0660 /dev/block/mmcblk0

    # change owner of sysrpc/mtest to allow atx/atxd access
    chown system system /sys/kernel/sysrpc/mtest

# Battery
   chown system radio /sys/class/power_supply/battery/batt_slate_mode
   chown system radio /sys/class/power_supply/battery/factory_mode
   chown system radio /sys/class/power_supply/battery/siop_level
   chown system radio /sys/class/power_supply/battery/wc_enable
   chown system radio /sys/class/power_supply/battery/update
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/call
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/video
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/music
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/browser
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/hotspot
   chown sdcard_rw sdcard_rw /sys/class/power_supply/battery/camera
   chown system radio /sys/class/power_supply/battery/talk_wcdma
   chown system radio /sys/class/power_supply/battery/talk_gsm
   chown system radio /sys/class/power_supply/battery/call
   chown system radio /sys/class/power_supply/battery/data_call
   chown system radio /sys/class/power_supply/battery/gps
   chown system radio /sys/class/power_supply/battery/wifi
   chown system radio /sys/class/power_supply/battery/lte
   chown system radio /sys/class/power_supply/battery/lcd

# fake some battery state
    setprop status.battery.state Slow
    setprop status.battery.level 10
    setprop status.battery.level_raw  100
    setprop status.battery.level_scale 10

# phone
    setprop ro.telephony.call_ring.multiple 0

# flash
    chown system radio /sys/class/camera/rear/rear_flash

#security driver
    chmod 0660 /dev/bcm_security
    chown radio root /dev/bcm_security
    mkdir /data/sec 0770
    chown radio root /data/sec

# GPIO DVS
    chown radio system /sys/class/secgpio_check/secgpio_check_all/check_init_detail
    chown radio system /sys/class/secgpio_check/secgpio_check_all/check_sleep_detail
    chown radio system /sys/class/secgpio_check/secgpio_check_all/gpio_sleep_debug
    chown radio system /sys/class/secgpio_check/secgpio_check_all/gpioinfo_check
    chown radio system /sys/class/secgpio_check/secgpio_check_all/gpioinit_check
    chown radio system /sys/class/secgpio_check/secgpio_check_all/gpiosleep_check

    # For WV DRM
    chown drm drm /dev/bcm_kbox
    chmod 0660 /dev/bcm_kbox

    # create directory for DRM plug-ins
    mkdir /data/drm 0770 drm drm

    # create directory for MediaDrm plug-ins - give drm the read/write access to
    # the following directory.
    mkdir /data/mediadrm 0770 mediadrm mediadrm

# [ SEC_MM_DRM
    # DRM directory creation
    mkdir /system/etc/security/.drm 0775
    chown root root /system/etc/security/.drm
    chmod 0775 /system/etc/security/.drm

    # Added drm folder to copy drm plugins
    mkdir /system/lib/drm 0775
    chown root root /system/lib/drm
    chmod 0775 /system/lib/drm
# ]

# allow user space (atx) access to kernel pm debug
    chown system system /sys/module/pm_dbg/parameters/debug
    chmod 0660 /sys/module/pm_dbg/parameters/debug
    chown system system /sys/module/bcmpmu59xxx_ponkey/parameters/simulate_ponkey
    chmod 0660 /sys/module/bcmpmu59xxx_ponkey/parameters/simulate_ponkey
    chown system system /sys/module/pm_dbg/parameters/debug
    chmod 0660 /sys/module/pm_dbg/parameters/debug

# BEGIN BCM QUICK BOOT FEATURE
    chown root system /sys/ponkey/ponkey_mode
    chmod 0664 /sys/ponkey/ponkey_mode
# END BCM QUICK BOOT FEATURE

# SEC_PRODUCT_FEATURE_COMMON_USE_MULTISIM
    setprop ro.multisim.simslotcount 2

#for efs
     chown radio system /efs
     chmod 0771 /efs

# Broadcom GPS
    mkdir /data/system 0771 system system
    chown system system /data/system
    mkdir /data/system/gps 0771 system system
    chown system system /data/system/gps
    rm /data/gps_started
    rm /data/glonass_started
    rm /data/beidou_started
    rm /data/smd_started
    rm /data/sv_cno.info

#permissions for cpufreq
    chown radio system sys/power/cpufreq_min_limit
    chown radio system sys/power/cpufreq_max_limit
    chown radio system sys/power/cpufreq_table
    chmod 0660 /sys/power/cpufreq_min_limit
    chmod 0660 /sys/power/cpufreq_max_limit
    chmod 0660 /sys/power/cpufreq_table

# permissions for cpuhotplug
    chown radio system /sys/devices/system/cpu/cpuhotplug/cpu_num_min_limit
    chown radio system /sys/devices/system/cpu/cpuhotplug/cpu_num_limit
    chmod 0660 /sys/devices/system/cpu/cpuhotplug/cpu_num_min_limit
    chmod 0660 /sys/devices/system/cpu/cpuhotplug/cpu_num_limit

# permissions for cpuonline
    chown radio system /sys/devices/system/cpu/cpu0/online
    chown radio system /sys/devices/system/cpu/cpu1/online
    chown radio system /sys/devices/system/cpu/cpu2/online
    chown radio system /sys/devices/system/cpu/cpu3/online
    chmod 0660 /sys/devices/system/cpu/cpu0/online
    chmod 0660 /sys/devices/system/cpu/cpu1/online
    chmod 0660 /sys/devices/system/cpu/cpu2/online
    chmod 0660 /sys/devices/system/cpu/cpu3/online

# permissions for bluetooth.
   setprop ro.bt.bdaddr_path "/efs/bluetooth/bt_addr"
   chown bluetooth net_bt_stack ro.bt.bdaddr_path
   symlink /system/etc/dbus.conf /etc/dbus.conf
   symlink /system/etc/bluetooth /etc/bluetooth
   mkdir /efs/bluetooth 0775 radio system
   mkdir /data/misc 01771 system misc
   mkdir /data/misc/bluetoothd 0770 bluetooth bluetooth
   mkdir /data/misc/bluetooth 0770 system system
   chmod 0770 /data/misc/bluetoothd
   chmod 0770 /data/misc/bluetooth
   chown bluetooth bluetooth /data/misc/bluetoothd
   chown bluetooth bluetooth /data/misc/bluetooth
   chown root bluetooth /dev/ttyS0
   chmod 0770 /dev/ttyS0
   chmod 0770 /dev/ttyS1
   chmod 0660 /sys/class/rfkill/rfkill0/state
   chown bluetooth bluetooth /sys/class/rfkill/rfkill0/state
   chown bluetooth bluetooth /sys/class/rfkill/rfkill0/type
   chmod 0777 /system/bin/btld

#LCD
    chown system system /sys/class/backlight/panel/brightness
    chmod 0664 system /sys/class/backlight/panel/brightness

#Enable PMTUD tcp_mtu_probing
    write /proc/sys/net/ipv4/tcp_mtu_probing 1

# needed to avoid the 7-minute-halt issue in (DOS) passive mode ftp on vodafone networ
    write /proc/sys/net/ipv4/netfilter/ip_conntrack_tcp_be_liberal 1

# Permissions for System Server and daemons.
    chown system system /sys/devices/platform/panel/backlight/panel/brightness

on charger
    exec sfsck /dev/block/mmcblk0p23 ext4
    mount ext4 /dev/block/mmcblk0p23 /system ro,barrier=1 wait
    exec sfsck /dev/block/mmcblk0p25 ext4
    mount ext4 /dev/block/mmcblk0p25 /data noatime,nosuid,nodev,nomblk_io_submit wait,encryptable=footer,check
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "powersave"

    class_start core
    start console

on alarm
    class_start core
    start drm
    start media
    start console

on property:ro.config.zram.support=true
    setprop sys.vm.swappiness 100
    write /proc/sys/vm/page-cluster  0
    start zram

on property:ro.config.ksm.support=true
    write /sys/kernel/mm/ksm/pages_to_scan 100
    write /sys/kernel/mm/ksm/sleep_millisecs 500
    write /sys/kernel/mm/ksm/run   1

    symlink /dev/spipe_w1 /dev/vbpipe1
    symlink /dev/spipe_w2 /dev/vbpipe2
    symlink /dev/spipe_w3 /dev/vbpipe3
    symlink /dev/spipe_w6 /dev/vbpipe6
    start refnotify_w
    start nvitemd_w

    chmod 0666 /proc/pin_switch/iis0_sys_sel/cp0_iis0
    chmod 0666 /proc/pin_switch/iis0_sys_sel/cp1_iis0
    chmod 0666 /proc/pin_switch/iis0_sys_sel/cp2_iis0
    chmod 0666 /proc/pin_switch/iis0_sys_sel/ap_iis0
    chmod 0666 /proc/pin_switch/bt_iis_sys_sel/cp0_iis0
    chmod 0666 /proc/pin_switch/bt_iis_sys_sel/cp1_iis0
    chmod 0666 /proc/pin_switch/bt_iis_sys_sel/cp2_iis0
    chmod 0666 /proc/pin_switch/bt_iis_sys_sel/ap_iis0

on post-fs-data
    setprop vold.post_fs_data_done 1

# This will make sure that sdcard service starts as late_start.
on nonencrypted
    setprop ro.fuse_sdcard ${persist.fuse_sdcard}

on property:vold.decrypt=trigger_restart_framework
    setprop ro.fuse_sdcard ${persist.fuse_sdcard}

#Indicate boot complete to PM to complete PM initialization
on property:dev.bootcomplete=1
    write /dev/console [AUTOTEST]BOOT_COMPLETE
    write /sys/module/pwr_mgr/parameters/pm_late_init 1
    write /sys/class/input/input1/enable 1
    start copy_cp_imgs

on property:persist.sys.storage_preload=1
    mount ext4 /dev/block/mmcblk0p19 /preload nosuid nodev noatime wait ro
    setprop storage.preload.complete 1

on property:persist.sys.storage_preload=0
    start umount_service